(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0dee28"],{"880b":function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"wrapper"}},[s("navbar",{staticClass:"no-print animate__animated animate__fadeInLeft",staticStyle:{display:"none"},attrs:{id:"nav"}}),s("div",{staticClass:"d-flex flex-column animate__animated animate__fadeInRight",staticStyle:{display:"none !important"},attrs:{id:"content-wrapper"}},[s("div",{attrs:{id:"content"}},[s("header-btn",{staticClass:"no-print"}),s("div",{staticClass:"container-fluid text-dark"},[s("div",{staticClass:"row"},[s("select",{directives:[{name:"model",rawName:"v-model",value:e.st_id,expression:"st_id"}],staticClass:"col-sm-4 form-control",on:{change:function(t){var s=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.st_id=t.target.multiple?s:s[0]}}},[s("option",{attrs:{value:""}}),e._l(e.staffs.filter((function(t){return t.special_staff==e.showSpecialStaffs})),(function(t){return s("option",{key:"s"+t.st_id,domProps:{value:t.st_id}},[e._v(" "+e._s(t.staff_name)+" ")])}))],2),s("span",{staticClass:"col-1"},[s("v-checkbox",{staticClass:"mt-0 custom-checkbox-label",attrs:{"true-value":"true","false-value":"false",label:"Specials"},model:{value:e.showSpecialStaffs,callback:function(t){e.showSpecialStaffs=t},expression:"showSpecialStaffs"}})],1),s("button",{staticClass:"btn btn-success col-xl-2 col-md-5 mx-2 mb-2",attrs:{"data-toggle":"modal","data-target":"#mdl_expense"},on:{click:function(t){return e.clear_expense()}}},[e._v(" Add Expense "),s("i",{staticClass:"fa fa-plus"})]),s("a",{staticClass:"btn btn-primary text-white col-xl-2 col-md-5 mx-2 mb-2",attrs:{href:"/staff_expenses_report"}},[e._v(" Report ")]),s("button",{staticClass:"btn btn-info col-xl-2 col-md-5 mx-2 mb-2",attrs:{"data-toggle":"modal","data-target":"#mdl_projects"},on:{click:function(t){return e.clear_project()}}},[e._v(" Projects ")])])]),s("hr",{staticClass:"my-0"}),s("v-data-table",{staticClass:"mx-2 mt-1",attrs:{headers:e.headers,items:e.rows},scopedSlots:e._u([{key:"item.price",fn:function(t){var s=t.item;return[e._v(" "+e._s(s.price.toLocaleString())+" ")]}},{key:"item.total",fn:function(t){var s=t.item;return[e._v(" "+e._s(s.total.toLocaleString())+" ")]}},{key:"item.expense_date",fn:function(t){var s=t.item;return[e._v(" "+e._s(new Date(s.expense_date).toISOString().split("T")[0])+" ")]}},{key:"item.actions",fn:function(t){var a=t.item;return[s("v-btn",{attrs:{icon:"",color:"primary","data-toggle":"modal","data-target":"#mdl_expense"},on:{click:function(t){return e.get_single_expense(a)}}},[s("v-icon",[e._v(" mdi-pencil ")])],1),s("v-btn",{attrs:{icon:"",color:"error"},on:{click:function(t){return e.delete_expense(a.staff_expense_id)}}},[s("v-icon",[e._v(" mdi-delete ")])],1)]}}],null,!0)})],1)]),s("div",{staticClass:"modal text-dark animate__animated animate__fadeInDown animate__faster",attrs:{id:"mdl_expense"}},[s("div",{staticClass:"modal-dialog modal-lg"},[s("div",{staticClass:"modal-content"},[s("div",{staticClass:"modal-header"},[s("button",{staticClass:"btn btn-danger",attrs:{"data-dismiss":"modal"},on:{click:function(t){return e.clear_expense()}}},[e._v("×")]),s("h5",{staticClass:"mt-2"},[e._v(" Expense ")])]),s("div",{staticClass:"modal-body"},[s("div",{staticClass:"container-fluid"},[s("div",{staticClass:"row mb-3"},[s("label",{staticClass:"col-xl-1 mt-2 px-0"},[e._v(" Staff: ")]),s("select",{directives:[{name:"model",rawName:"v-model",value:e.single_expense.st_id,expression:"single_expense.st_id"}],staticClass:"form-control col-xl-11 mx-0",on:{change:function(t){var s=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.$set(e.single_expense,"st_id",t.target.multiple?s:s[0])}}},[s("option",{attrs:{value:""}}),e._l(e.staffs.filter((function(t){return t.special_staff==e.showSpecialStaffs})),(function(t){return s("option",{key:t.st_id,domProps:{value:t.st_id}},[e._v(" "+e._s(t.staff_name)+" ")])}))],2)]),s("div",{staticClass:"row mb-3"},[s("label",{staticClass:"col-xl-1 mt-2 px-0"},[e._v(" Date: ")]),s("input",{directives:[{name:"model",rawName:"v-model",value:e.single_expense.expense_date,expression:"single_expense.expense_date"}],staticClass:"form-control col-xl-11 mx-0",attrs:{type:"date"},domProps:{value:e.single_expense.expense_date},on:{input:function(t){t.target.composing||e.$set(e.single_expense,"expense_date",t.target.value)}}})]),s("div",{staticClass:"row mb-3"},[s("label",{staticClass:"col-xl-1 mt-2 px-0 ms-n1"},[e._v(" Expense: ")]),s("textarea",{directives:[{name:"model",rawName:"v-model",value:e.single_expense.expense_text,expression:"single_expense.expense_text"}],staticClass:"form-control col-xl-11 ms-1 mx-0",domProps:{value:e.single_expense.expense_text},on:{input:function(t){t.target.composing||e.$set(e.single_expense,"expense_text",t.target.value)}}})]),s("div",{staticClass:"row mb-3"},[s("label",{staticClass:"col-xl-1 mt-2 px-0"},[e._v(" Quantity: ")]),s("input",{directives:[{name:"model",rawName:"v-model",value:e.single_expense.qty,expression:"single_expense.qty"}],staticClass:"form-control col-xl-11 mx-0",attrs:{type:"number"},domProps:{value:e.single_expense.qty},on:{input:function(t){t.target.composing||e.$set(e.single_expense,"qty",t.target.value)}}})]),s("div",{staticClass:"row mb-3"},[s("label",{staticClass:"col-xl-1 mt-2 px-0"},[e._v(" Unit: ")]),s("input",{directives:[{name:"model",rawName:"v-model",value:e.single_expense.unit,expression:"single_expense.unit"}],staticClass:"form-control col-xl-11 mx-0",attrs:{type:"text"},domProps:{value:e.single_expense.unit},on:{input:function(t){t.target.composing||e.$set(e.single_expense,"unit",t.target.value)}}})]),s("div",{staticClass:"row mb-3"},[s("label",{staticClass:"col-xl-1 mt-2 px-0"},[e._v(" Price: ")]),s("input",{directives:[{name:"model",rawName:"v-model",value:e.single_expense.price,expression:"single_expense.price"}],staticClass:"form-control col-xl-11 mx-0",attrs:{type:"number"},domProps:{value:e.single_expense.price},on:{input:function(t){t.target.composing||e.$set(e.single_expense,"price",t.target.value)}}})]),s("div",{staticClass:"row mb-3"},[s("label",{staticClass:"col-xl-1 mt-2 px-0"},[e._v(" Project: ")]),s("select",{directives:[{name:"model",rawName:"v-model",value:e.single_expense.project_id,expression:"single_expense.project_id"}],staticClass:"form-control col-xl-11 mx-0",on:{change:function(t){var s=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.$set(e.single_expense,"project_id",t.target.multiple?s:s[0])}}},[s("option",{attrs:{value:""}}),e._l(e.projects,(function(t){return s("option",{key:t.project_id,domProps:{value:t.project_id}},[e._v(" "+e._s(t.project_name)+" ")])}))],2)]),s("div",{staticClass:"row mb-3"},[s("label",{staticClass:"col-xl-1 mt-2 px-0"},[e._v(" Location: ")]),s("input",{directives:[{name:"model",rawName:"v-model",value:e.single_expense.location,expression:"single_expense.location"}],staticClass:"form-control col-xl-11 mx-0",attrs:{type:"text"},domProps:{value:e.single_expense.location},on:{input:function(t){t.target.composing||e.$set(e.single_expense,"location",t.target.value)}}})]),s("div",{staticClass:"row mb-3"},[e.single_expense.staff_expense_id?s("button",{staticClass:"btn btn-warning col-xl-12 mx-0",attrs:{id:"btn-update"},on:{click:function(t){return e.update_expense()}}},[e._v(" Update "),s("i",{staticClass:"fa fa-save"})]):s("button",{staticClass:"btn btn-success col-xl-12 mx-0",attrs:{id:"btn-add"},on:{click:function(t){return e.add_expense()}}},[e._v(" Add Expense "),s("i",{staticClass:"fa fa-plus"})])])])])])])]),s("div",{staticClass:"modal text-dark animate__animated animate__fadeInDown animate__faster",attrs:{id:"mdl_projects"}},[s("div",{staticClass:"modal-dialog"},[s("div",{staticClass:"modal-content"},[s("div",{staticClass:"modal-header"},[s("button",{staticClass:"btn btn-danger",attrs:{"data-dismiss":"modal"},on:{click:function(t){return e.clear_project()}}},[e._v(" × ")]),s("h5",{staticClass:"mt-2 jobs"},[e._v(" Project ")])]),s("div",{staticClass:"modal-body"},[s("div",{staticClass:"container-fluid"},[s("div",{staticClass:"row mb-2"},[s("label",{staticClass:"col-sm-3 mt-3"},[e._v(" ID: ")]),s("label",{staticClass:"col-sm-9 form-control disable mt-2"},[e._v(" "+e._s(e.single_project.project_id)+" ")])]),s("div",{staticClass:"row mb-2"},[s("label",{staticClass:"col-sm-3 mt-2"},[e._v(" Project Name: ")]),s("input",{directives:[{name:"model",rawName:"v-model",value:e.single_project.project_name,expression:"single_project.project_name"}],staticClass:"col-sm-9 form-control",attrs:{type:"text"},domProps:{value:e.single_project.project_name},on:{input:function(t){t.target.composing||e.$set(e.single_project,"project_name",t.target.value)}}})]),s("hr"),s("div",{staticClass:"row mb-2"},[s("div",{class:{"col-sm-6":null!=e.single_project.project_id,"col-sm-12":null==e.single_project.project_id}},[s("button",{staticClass:"btn btn-success btn-block",on:{click:function(t){return e.add_project()}}},[e._v(" Add "),s("i",{staticClass:"fa fa-plus"})])]),null!=e.single_project.project_id?s("div",{staticClass:"col-sm-6"},[s("button",{staticClass:"btn btn-warning btn-block",attrs:{id:"btn_update_project"},on:{click:function(t){return e.update_project()}}},[e._v(" Save Changes "),s("i",{staticClass:"fa fa-save"})])]):e._e()]),s("hr"),s("div",{staticClass:"row"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.project_search,expression:"project_search"}],staticClass:"form-control mb-2",attrs:{type:"text",placeholder:"Search ..."},domProps:{value:e.project_search},on:{input:function(t){t.target.composing||(e.project_search=t.target.value)}}}),s("table",{staticClass:"table table-bordered table-striped text-center text-dark"},[e._m(0),s("tbody",e._l(e.filtered_projects,(function(t){return s("tr",{key:t.project_id},[s("td",[e._v(" "+e._s(t.project_id)+" ")]),s("td",[e._v(" "+e._s(t.project_name)+" ")]),s("td",[s("button",{staticClass:"btn btn-primary mx-1",on:{click:function(s){return e.get_project(t.project_id)}}},[s("i",{staticClass:"fa fa-edit"})]),s("button",{staticClass:"btn btn-danger mx-1",on:{click:function(s){return e.delete_project(t.project_id)}}},[s("i",{staticClass:"fa fa-trash"})])])])})),0)])])])])])])])],1)},n=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("thead",[s("th",{staticStyle:{width:"6%"}},[e._v(" ID ")]),s("th",{staticClass:"job_title"},[e._v(" Project Name ")]),s("th",{staticStyle:{width:"30%"}},[e._v(" Actions ")])])}],i=s("c735"),l=s("1ab6");const o=["",null];var r={name:"staff_expenses",data(){return{st_id:null,single_expense:{staff_expense_id:null,expense_text:null,st_id:null,qty:0,unit:null,price:0,user:"",expense_date:(new Date).toISOString().split("T")[0],project_id:null,location:null},single_project:{project_id:null,project_name:""},staffs:[],rows:[],user:{username:"",role:"",en_id:null},headers:[{text:"Form",align:"start",sortable:!0,value:"form"},{text:"Expense",align:"start",sortable:!1,value:"expense_text"},{text:"Staff",align:"start",sortable:!1,value:"staff_name"},{text:"Quantity",align:"start",sortable:!1,value:"qty"},{text:"Unit",align:"start",sortable:!1,value:"unit"},{text:"Price",align:"start",sortable:!1,value:"price"},{text:"Total",align:"start",sortable:!1,value:"total"},{text:"Project",align:"start",sortable:!1,value:"project_name"},{text:"Location",align:"start",sortable:!1,value:"location"},{text:"Date",align:"start",sortable:!0,value:"expense_date"},{text:"User",align:"start",sortable:!1,value:"user"},{text:"Actions",align:"center",sortable:!1,value:"actions"}],showSpecialStaffs:"false",projects:[],project_search:""}},beforeCreate(){Object(l["a"])("salaryList")},created(){this.$http.post("/staff/getData").then(({data:e})=>{this.staffs=e.filter(e=>"1"==e.show_staff).sort((e,t)=>e.staff_sort_code-t.staff_sort_code)}),this.$http.post("/getLoggedInfo").then(({data:e})=>{this.user.username=e.username,this.user.role=e.type,this.user.en_id=e.en_id||null}),this.getData()},computed:{filtered_projects(){return this.projects.filter(e=>e.project_id==this.project_search||e.project_name.match(this.project_search))}},mounted(){setTimeout(()=>{this.$http.post("/projects/getData").then(({data:e})=>{this.projects=e})},1e3)},methods:{clear_expense(){this.single_expense={staff_expense_id:null,expense_text:null,st_id:null,qty:0,unit:null,price:0,user:"",expense_date:(new Date).toISOString().split("T")[0],project_id:null,location:null}},get_single_expense(e){this.single_expense.staff_expense_id=e.staff_expense_id,this.single_expense.expense_text=e.expense_text,this.single_expense.st_id=e.st_id,this.single_expense.project_id=e.project_id,this.single_expense.location=e.location,this.single_expense.qty=e.qty,this.single_expense.unit=e.unit,this.single_expense.price=e.price,this.single_expense.expense_date=new Date(e.expense_date).toISOString().split("T")[0]},getData(){this.st_id?this.$http.get("/staff_expenses/getByStaff/"+this.st_id).then(({data:e})=>{this.rows=e}):this.$http.get("/staff_expenses/all").then(({data:e})=>{this.rows=e})},add_expense(){this.single_expense.user=this.user.username,document.getElementById("btn-add").setAttribute("disabled","disabled"),this.$http.post("/staff_expenses/create",this.single_expense).then(({data:e})=>{this.single_expense.st_id!=this.st_id&&null!=this.st_id||this.rows.unshift(e),this.$set(this.single_expense,"qty",0),this.$set(this.single_expense,"price",0),this.$set(this.single_expense,"unit",null),this.$set(this.single_expense,"location",null)}).finally(()=>{document.getElementById("btn-add").removeAttribute("disabled")})},update_expense(){this.single_expense.user=this.user.username,document.getElementById("btn-update").setAttribute("disabled","disabled"),this.$http.patch("/staff_expenses/update/"+this.single_expense.staff_expense_id,this.single_expense).then(()=>{this.$alert("Updated Successfully","Success","success");let e=this.rows.findIndex(e=>e.staff_expense_id==this.single_expense.staff_expense_id);this.rows[e].st_id=this.single_expense.st_id,this.rows[e].expense_text=this.single_expense.expense_text,this.rows[e].qty=this.single_expense.qty,this.rows[e].unit=this.single_expense.unit,this.rows[e].price=this.single_expense.price,this.rows[e].expense_date=new Date(this.single_expense.expense_date).toISOString().split("T")[0],this.rows[e].user=this.single_expense.user,this.rows[e].total=this.single_expense.qty*this.single_expense.price}).finally(()=>{document.getElementById("btn-update").removeAttribute("disabled")})},delete_expense(e){this.$confirm("Are you sure you want to delete this expense?","Delete","question").then(()=>{this.$http.delete("/staff_expenses/delete/"+e).then(()=>{this.$alert("Deleted Successfully","Success","success"),this.rows=this.rows.filter(t=>t.staff_expense_id!=e)})})},add_project(){o.includes(this.single_project.project_name)?this.$alert("Enter a project name","","warning"):this.$http.post("/projects/addProject",{project_name:this.single_project.project_name}).then(({data:e})=>{this.projects.push({project_id:e.project_id,project_name:this.single_project.project_name}),this.clear_project()}).catch(e=>{Object(i["a"])(e)})},clear_project(){this.single_project.project_id=null,this.single_project.project_name=""},get_project(e){const[t]=this.projects.filter(t=>t.project_id==e);this.single_project.project_id=t.project_id,this.single_project.project_name=t.project_name},delete_project(e){this.$confirm("Are you sure delete this project ?","","question").then(()=>{this.$http.delete("/projects/deleteProject/"+e).then(()=>{this.projects=this.projects.filter(t=>t.project_id!=e),this.clear_project()}).catch(e=>{Object(i["a"])(e)})})},update_project(){null==this.single_project.project_id?this.$alert("Select a project","","warning"):o.includes(this.single_project.project_name)?this.$alert("Enter a project name","","warning"):this.$confirm("Are you sure to save changes ?","","question").then(()=>{document.getElementById("btn_update_project").setAttribute("disabled","disabled"),this.$http.post("/projects/updateProject",{project_id:this.single_project.project_id,project_name:this.single_project.project_name}).then(()=>{let e=this.projects.findIndex(e=>e.project_id==this.single_project.project_id);this.projects[e].project_name=this.single_project.project_name,this.$alert("","Success","success"),this.clear_project()}).catch(e=>{Object(i["a"])(e)}).finally(()=>{document.getElementById("btn_update_project").removeAttribute("disabled")})})}},watch:{st_id(){this.getData()}}},c=r,p=s("2877"),d=s("6544"),_=s.n(d),u=s("8336"),m=s("ac7c"),x=s("8fea"),f=s("132d"),h=Object(p["a"])(c,a,n,!1,null,null,null);t["default"]=h.exports;_()(h,{VBtn:u["a"],VCheckbox:m["a"],VDataTable:x["a"],VIcon:f["a"]})}}]);
//# sourceMappingURL=chunk-2d0dee28.15853198.js.map